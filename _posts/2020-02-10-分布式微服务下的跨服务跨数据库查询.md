---
layout: post
title: 分布式微服务下的跨服务跨数据库查询
subtitle: 微服务间查询
tags: [分布式, 微服务, 数据库, SpringCloud]
---

分布式微服务之间的产生数据关联性的解决方案从宏观条件上讲分为三种类型（个人总结）：

1.从数据库层面直接解决；

2.从服务层面直接解决；

3.从第三方中间件层面间接解决；

### 1.数据库层面直接解决；

```
1.1:表字段冗余
	使用表字段冗余，但是冗余字段不能太多，一般不多于4个。否则在数据更新不一致问题，一旦冗余字段有改动，极容易产生脏数据。建议建立同步机制，在必要时采取人工补偿措施。这个方案个人认为比较适合对数据一致性要求偏低，业务上对冗余字段使用率较低的场景。
	
1.2:数据库视图
	视图查询高效便捷，而且解决了表字段冗余带来的脏数据问题，但是相应的产生了一些前置条件，并且系统业务耦合度增加，不利于后期的业务扩展。
	前提条件：
		1.数据库需要部署在同一台服务器上
		2.数据库账户密码必须相同，也就是在同一个schema下
```
### 2.服务层面直接解决；

```
1.1:服务间接口调用
	使用RPC或者http(feign)进行服务间调用的方式，更符合解耦合的设计，利于后期的业务扩展，但是会有性能损耗，http服务会比RPC理论上损耗更多。在单条数据调用情况下好操作，但是在分页数据，尤其是大量数据时并不好实现。
	
1.2:多数据库
	在服务中配置多数据源，使用数据源的切换方式进行跨库查询。在不想大动干戈的使用数据库中间件的情况下，个人认为是最优方案。
```
### 3.第三方中间件层面间接解决；

```
	目前第三方的数据库中间件mycat和sharding-jdbc是比较火的，个人推荐使用sharding-jdbc。从个人价值观来说，欣赏不了mycat社区的leaderus作风。从实际技术角度看，mycat更新巨慢，bug也多，文档水平低导致的学习成本大，很难让人投入mycat的怀抱
```


